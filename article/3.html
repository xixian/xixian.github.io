<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="dns-prefetch" href="//cdn.bootcss.com"/>
    <link rel="dns-prefetch" href="//secure.gravatar.com"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-transform"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <title>ESXi搭建 ALL IN ONE 服务器之双软路由篇-  资源分享- 天下长安长乐未央</title>
    <meta name="keywords" content="ESXi,软路由"/>
    <meta name="description" content="ESXi搭建 ALL IN ONE 服务器之双软路由篇..."/>
    <script type="text/javascript">(function () { var event = document.addEventListener ? { add: 'addEventListener', triggers: ['scroll', 'mousemove', 'keyup', 'touchstart'], load: 'DOMContentLoaded' } : { add: 'attachEvent', triggers: ['onfocus', 'onmousemove', 'onkeyup', 'ontouchstart'], load: 'onload' }, added = false; document[event.add](event.load, function () { var r = document.getElementById('respond-post-32'), input = document.createElement('input'); input.type = 'hidden'; input.name = '_'; input.value = (function () { var _FWhdMh = '7d'+'Xr'+'5'+'31'+'54'+'7'+'ee4'+'b0c'+'40'+'7'+/* 'Em''a0'+'654'+'b'+'d3'+'75'+''+'SAu'+''+'e37'+'37', _ViJONV = [[2,4],[27,30]]; for (var i = 0; i < _ViJONV.length; i ++) { _FWhdMh = _FWhdMh.substring(0, _ViJONV[i][0]) + _FWhdMh.substring(_ViJONV[i][1]); } return _FWhdMh;})(); if (null != r) { var forms = r.getElementsByTagName('form'); if (forms.length > 0) { function append() { if (!added) { forms[0].appendChild(input); added = true; } } for (var i = 0; i < event.triggers.length; i ++) { var trigger = event.triggers[i]; document[event.add](trigger, append); window[event.add](trigger, append); } } } });})();</script>
    <link href="//cdn.bootcss.com/highlight.js/9.10.0/styles/xcode.min.css" rel="stylesheet">
    <link href="/static/pingsu/style.min.css?20230522" rel="stylesheet">
    <!--[if lt IE 9]> <script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script> <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script> <![endif]-->
</head>
<body class="" gtools_scp_screen_capture_injected="true">
    <!--[if lt IE 8]> <div class="browsehappy" role="dialog"> 当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/" target="_blank">升级你的浏览器</a>。 </div> <![endif]-->

    <header id="header" class="header bg-white">
        <div class="navbar-container">
            <a href="/" class="navbar-logo">
                <img src="/static/pingsu/images/crossplane-icon.svg" alt="天下长安长乐未央"/> <img src="/static/pingsu/images/logo.png" alt="天下长安长乐未央"/>
            </a>
            <div class="navbar-menu">

<a href="/list/Web/">Web</a>
                <a href="/list/VPS/">VPS</a>
                <a href="/list/Windows/">Windows</a>
                <a href="/list/Android/">Android</a>
                <a href="/list/iOS/">iOS</a>
                <a href="/list/Mac/">Mac</a>
                <a href="/list/PVE/">PVE</a>
                <a href="/list/ESXI/">ESXI</a>
                <a href="/list/OpenWrt/">OpenWrt</a>
                <a href="/list/iKuai/"> iKuai</a>
                <a href="/list/Synology/">Synology</a>
                <a href="/list/QNAP/">QNAP</a>
                <a href="/list/Docker/">Docker</a>
                <a href="/Share/">Share</a>

  
 

            </div>


<!--
       <div class="navbar-search" onclick="">
                <span class="icon-search"></span>
                <form id="search" method="post" action="/" role="search">
                    <span class="search-box">
                        <input type="text" id="input" class="input" name="s" required="true" placeholder="Search..." maxlength="30" autocomplete="off">
                    </span>
                </form>
            </div>
-->


            <div class="navbar-mobile-menu" onclick="">
                <span class="icon-menu cross">
                    <span class="middle"></span>
                </span>
                <ul>

                    <li>
                        <a class="current" href="/list/Web/">Web</a>
                    </li>
                    <li>
                        <a href="/list/VPS/">VPS</a>
                    </li>
                    <li>
                        <a href="/list/Windows/">Windows</a>
                    </li>
                    <li>
                        <a href="/list/Android/">Android</a>
                    </li>
                    <li>
                        <a href="/list/iOS/">iOS</a>
                    </li>
                    <li>
                        <a href="/list/Mac/">Mac</a>
                    </li>
                    <li>
                        <a href="/list/PVE/">PVE</a>
                    </li>
                    <li>
                        <a href="/list/ESXI/">ESXI</a>
                    </li>
                    <li>
                        <a href="/list/OpenWrt/">OpenWrt</a>
                    </li>
                    <li>
                        <a href="/list/iKuai/"> iKuai</a>
                    </li>
                    <li>
                        <a href="/list/Synology/">Synology</a>
                    </li>
                    <li>
                        <a href="/list/QNAP/">QNAP</a>
                    </li>
                    <li>
                        <a href="/list/Docker/">Docker</a>
                    </li>
                    <li>
                        <a href="/list/VPN/">VPN</a>
                    </li>
                    <li>
                        <a href="//Share/">Share</a>
                    </li>

                </ul>
            </div>
        </div>
    </header>
    <div class="post-header-thumb bg-deepgrey">
        <div class="post-header-thumb-op" style="background-image:url(/static/pingsu/images/6.jpg" alt=");"></div>
        <div class="post-header-thumb-cover">
            <div class="post-header-thumb-container">
                <div class="post-header-thumb-title"> ESXi搭建 ALL IN ONE 服务器之双软路由篇</div>
                <div class="post-header-thumb-meta">
                    <time datetime="2023-10-25T10:39:00+08:00" itemprop="datePublished">Published on 2023-10-25 21:47:46</time>
                     in 
                    <a href="/Share/">资源分享</a>
          
                     with 
                    <a href="#comments"> 0 comment</a>
                </div>
                <div class="post-tags">
<a href="/e/tags/?tagname=ESXi" target="_blank">ESXi</a>&nbsp;<a href="/e/tags/?tagname=%E8%BD%AF%E8%B7%AF%E7%94%B1" target="_blank">软路由</a>                </div>
            </div>
        </div>
    </div>
    <article class="main-content post-page" itemscope itemtype="http://schema.org/Article">
        <div class="post-header">
            <h1 class="post-title" itemprop="name headline">ESXi搭建 ALL IN ONE 服务器之双软路由篇 </h1>
            <div class="post-data">
                <time datetime="2023-10-25T10:39:00+08:00" itemprop="datePublished">Published on 2023-10-25 21:47:46</time>
                 in 
                    <a href="/Share/">资源分享</a>
                 with 
                <a href="#comments"> 0 comment</a>
            </div>
        </div>
        <div id="post-content" class="post-content" itemprop="articleBody">
            <p class="post-tags">
<a href="/e/tags/?tagname=ESXi" target="_blank">ESXi</a>&nbsp;<a href="/e/tags/?tagname=%E8%BD%AF%E8%B7%AF%E7%94%B1" target="_blank">软路由</a>            </p>

            <div class="common-title">  您现在的位置是：<a href="/">首页</a>&nbsp;>&nbsp;<a href="/Share/">资源分享</a></div>

            <p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
            <p><a href="https://post.smzdm.com/p/akx3z85e/">https://post.smzdm.com/p/akx3z85e/</a></p>
<p>次给大家带来的是双软路由的教学！iKuai+openwrt&nbsp;</p>
<p>实现了爱快作为主路由，负责多拨号+控流，openwrt负责旁路上网。</p>
<p>后面还会教大家搞定双软路由的IPV6上网!&nbsp;</p>
<p>为了方便设置，目前我把esxi管理口网线插在路由器上面了！局域网可以直接访问esxi！</p>
<p>稍后我会把路由器改成ap模式，路由器作为交换机使用。</p>
<p>【主要是因为穷，买不起交换机】</p>
<p>先放上我想象中的家庭网络拓扑图，捋一下思路！为后面的设置做铺垫！<br />网络拓扑图网络拓扑图</p>
<p>我这台all in one机器，一共有五个网口 [主板自带一个+4口pcie网卡]</p>
<p>主板自带的网口已经给esxi作为管理口了【不能直通！】，所以接下来我直通的都是那张加装的四口pcie网卡！</p>
<p>我准备其中前2个网口直通给爱快主路由 [ 一个当wan口拨号，一个当lan口，用来链接AP交换机 ]</p>
<p>第三个网口直通给OP旁路由，做lan口进行数据交换！第四个网口直通给群晖虚拟机！</p>
<p>我目前硬路由设置的局域网IP为10.10.10.1-10.10.10.254<br />接下来每个设备准备设置的IP地址：<br />ESXi管理口：10.10.10.100 爱快[主路由]：10.10.10.250 openwrt[旁路由]：10.10.10.251 群晖：10.10.10.10</p>
<p>注意:如果你是对局域内网都一窍不通的小白，请不要抄我的IP设置，设置IP之前可以看一下路由器的IP，这里我举例：比如你目前路由器IP为192.168.2.1，就可以像下面这样设置设备IP【更不容易冲突，当然也可以设置别的】</p>
<p>ESXi管理口：192.168.2.100 爱快[主路由]：192.168.2.250 openwrt[旁路由]：192.168.2.251群晖：192.168.2.10 &middot;&middot;&middot;&middot;&middot;&middot;自己设置的IP，一定要记好，两台设备如果IP不是同一个网段，是无法互相访问的，请知悉!</p>
<p>一定要对你的局域网做好规划！不要盲目抄作业，切记！切记！切记！</p>
<p>这里再提一嘴，其实做软路由 2 个网口也可以稳定运行，前提是你的 cpu 性能够！<br />一个网口做 esxi 的管理口，1 个网口拿来直通给主路由拨号！<br />其他网口全部用虚拟的网口就可以，网口类型用 vmxnet 3【性能比较好！】</p>
<p>如果是双网口的兄弟，可以把以下教程的直通网口忽略掉！保留虚拟网口做 lan 口即可！！</p>
<p>如果是 4 网口或 6 网口这种成品软路由，记得预留一个网口给 esxi 做管理口，其他网口都可以直通【切记不要全部网口一起直通，也不要直通错了，别把管理口给直通了！否则 esxi 会失联！】</p>
<p>思路已经很清晰了，接下来我们先做好准备工作！<br />第一部分准备工作：先去esxi后台，把网卡直通一下！<br />1.进入 esxi 后台，点击 主机&rarr;管理&rarr;pci 设备 ，勾选需要直通的网口，点击切换直通</p>
<p>这里我选择四个网卡全部直通，板载的 219lm 网卡做管理口，不直通！</p>
<p>选择网卡直通选择网卡直通</p>
<p>点击切换直通后，重启一下 esxi 系统！</p>
<p>重启esxi重启esxi</p>
<p>重启后观察网卡后面是否为活动状态，活动即代表直通成功！</p>
<p>直通网卡成功！直通网卡成功！</p>
<p>这部分设置仅针对使用虚拟网口的OP旁路由，如果你是直通物理网口给OP，请忽略！</p>
<ol start="2">
	<li>接着我们还要设置一下板载的 219v 网口【管理口】&nbsp;<br />esxi 后台 选择网络&rarr;虚拟交换机&rarr;选择 vSwitch0&rarr;编辑设置</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>接着点击安全，把混杂模式改成接受，然后点击保存即可！<br />【这步很关键，如果没设置成接受，管理口这个网卡就无法跟其他 pcie 网口交换数据，无法上网！】</p>
<p>打开混杂模式打开混杂模式</p>
<p>第二部分准备工作：下载软路由需要用到的镜像包，然后上传到esxi！<br />附上镜像下载链接！<br />百度网盘链接：<a href="https://pan.baidu.com/s/1HiWPZNk3g7OPl_KICvWV7g">https://pan.baidu.com/s/1HiWPZNk3g7OPl_KICvWV7g</a>(提取码：1314)<br />天翼云盘链接：<a href="https://cloud.189.cn/t/baiqauQjI322">https://cloud.189.cn/t/baiqauQjI322</a>(访问码：6d1v)</p>
<p>镜像下载好后，把文件分别上传到 ESXi，建议单独建立文件夹，这样方便分辨！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>上传openwrt上传openwrt</p>
<p>爱快安装篇 [主路由]：</p>
<ol>
	<li>新建虚拟机，大家参考我的设置<br />ESXi搭建 ALL IN ONE 服务器之双软路由篇</li>
	<li>设置一个名称，系统系列选择 linux ，系统版本选 其他 3.x linux (64 位)<br />ESXi搭建 ALL IN ONE 服务器之双软路由篇</li>
	<li>选择安装位置，然后下一页</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<ol start="4">
	<li>配置虚拟机参数，这里我们 cpu 可以设置满核心，性能最大化 [如果是高性能 cpu 实际上也占用不到多少。按需即可！]</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>CD/DVD 驱动器 这里选择导入爱快的 ISO 镜像</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>选择镜像选择镜像</p>
<p>5.然后我们再添加一下之前我们直通的 pcie 网卡。这里我只直通两个，1 个做 lan 口链接交换机，1 个做 wan 口进行拨号！</p>
<p>选择添加其他设备-----PCI设备!</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>注意网卡后面显示的编号，方便后续辨别网口接线顺序。比如第一个网口做 wan 或者最后一个做 wan。【如果分辨不清楚的话，建议先直通一个网卡绑定做 wan 口，配置好后再继续直通 lan！】</p>
<p>注意网口编号注意网口编号</p>
<p>最后说一下，切记：直通 pci 设备的话，内存高级设置里面必须要勾选一下【 预留所有客户机内存 (全部锁定) 】，不勾选会无法开机</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>6.设置完毕后勾选后点击下一页</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>然后点击完成即可【即虚拟机部署完成！】</p>
<p>保存虚拟机保存虚拟机</p>
<ol start="7">
	<li>在虚拟机里面找到我们刚刚部署好的爱快虚拟机，点击打开电源【开机】<br />接着点击虚拟机的窗口，会提示我们要选择安装系统的硬盘，我们选择 1，然后回车</li>
</ol>
<p>安装系统安装系统</p>
<p>接着虚拟机安装好后会自动重启！</p>
<ol start="9">
	<li>重启完毕后，我们来设置一下爱快的 LAN 口地址【管理口】 切记：管理口 IP 请设置成跟 ESXI - 局域网同网段 ip。按我截图操作！！！</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>设置管理口IP设置管理口IP</p>
<p>按我一开始规划的，esxi 管理口设置的是 10.10.10.100, 所以爱快管理口 IP 设置的也是同网段的【即10.10.10.250，大家也可以根据需求自行设置，填写好后回车保存即可】</p>
<p>管理口设置成功管理口设置成功</p>
<p>接着退出 LAN 口设置</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>然后重启一下爱快虚拟机</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>爱快重启成功后，WEB 管理地址【LAN 口】就会显示刚刚设置的 IP 了！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>到这里我们的虚拟机，爱快软路由系统层面就已经安装并且简单设置好了！接下来教大家如何进行详细上网配置！</p>
<p>爱快调教篇 [主路由]：</p>
<ol>
	<li>打开浏览器，输入爱快的管理口 IP，从网页端设置参数！</li>
</ol>
<p>默认账户密码都是:admin</p>
<p>[如果你网页输入管理口IP打不开爱快后台，说明访问的机器可能不在同一个局域网！这里建议你把电脑设备的网络手动设置一下，设置到跟爱快软路由同一个网段再来设置！]</p>
<p>爱快登录页面爱快登录页面</p>
<p>登录进去后，会提示你绑定爱快云平台，这里我们先不绑定吧因为爱快还没有通网络，后面有需要再来绑定！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<ol start="2">
	<li>我们这边优先设置一下主路由的 dhcp，方便后续的上网设置，到时候切换成 ap模式或者接交换机 接完线就可以正常分配 ip 上网！</li>
</ol>
<p>[因为我们是双软路由系统，所以这里我会新建两个 dhcp 服务器，注意我设置的 ip 范围，11-150 范围我是拿来国内正常上网，准备把 151-200 网段，给 op 旁路由上网！如果你只需要爱快，不需要 op 的话，建一个dhcp就可以！]</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>首先设置 新建的第一个 dhcp 的 ip 范围、网关、dns，这个dhcp负责局域网设备国内上网！</p>
<p>国内正常上网的网段！国内正常上网的网段！</p>
<p>接下来我们再添加第二个 dhcp 服务器。这个ip范围用来旁路由上网！<br />网关改为你后面需要 op 的管理地址。 [我设置的OP地址是 10.10.10.251]<br />首选 dns 第一个填写为 op 的 ip，备用 dns 可以填写自己喜欢的。</p>
<p>OP旁路的网段OP旁路的网段</p>
<p>设置完成后保存即可。</p>
<p>设置完成！设置完成！</p>
<ol start="3">
	<li>接着我们来到爱快主页，绑定一下我们拨号的网口【wan 口】<br />主页这里点击一下 WAN1 的图标，进入绑定网卡</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>根据我的经验来看，4 口网卡看 mac 地址就可以区分位置，这里我选择的是 MAC 数字最小那个口做 wan 口，等下插线插第一个或者倒数第一个就可以识别到的！</p>
<p>绑定wan口绑定wan口</p>
<p>点击绑定，然后接入方式改成 PPPoE 拨号模式</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>然后填入运营商提供的宽带账号跟密码，填入后保存。然后插入网线即可自动拨号！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>注意：拨号成功后，爱快 web 主页面。图标会变绿，而且状态信息会显示已链接，否则拨号失败，检查账户密码是否正确或光猫是否为桥接模式。</p>
<p>拨号成功！拨号成功！</p>
<ol start="4">
	<li>紧接着再把 LAN 口换绑成网卡，之前我们为了方便设置软路由，新建虚拟机 LAN 口是使用的虚拟网卡，这里我们已经设置完成了所以可以换绑成直通的网卡，降低虚拟机 cpu 的运算负载！</li>
</ol>
<p>首先跟之前绑定 wan 口一样，我们到爱快主页点击一下 LAN1，进行换绑</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>进去后网卡选择我们添加直通剩下的那个物理网口！然后点击保存即可</p>
<p>换绑物理网口换绑物理网口</p>
<p>保存好后，我们把爱快绑定的物理 lan 口，接上网线，然后网线接到 AP 或者交换机就可以正常上网了。【如果不能上网请重新看之前的设置教程！看看是不是步骤没做完！】</p>
<p>至此，爱快主路由的安装与调教就结束了！</p>
<p>接下来我这里着重给大家讲解一下，为何爱快要配置双dhcp，还有这样配置双软路由进行上网的好处！</p>
<p>大部分爱快 + op 教程都是两台软路由互相填写网关 IP，这样其实也不算什么大问题，但是使用久了可能 OP 插件会有炸网络的风险，因为全局域网设备的网络都要经过 OP。影响全家的上网体验！还大大增加虚拟机的功耗！</p>
<p>我相信对于 op 的上网需求，大部分人也就几台常用设备需要，但是一个一个手动指定 ip 的话，设置又太麻烦了，这里推荐大家可以考虑使用爱快的多 dhcp 进行 ip 分组，进行分流访问，需要经过 OP旁路由上网的，软路由后台把设备的 ip 固定一下就可以实现了。</p>
<p>本篇结尾处我会给大家实际演示一下！</p>
<p>接下来我们来配置一下openwrt[旁路由]</p>
<p>OpenWrt 安装篇 [旁路由]：</p>
<ol>
	<li>新建虚拟机，选择对应的系统系列版本。</li>
</ol>
<p>选择对应的版本选择对应的版本</p>
<ol start="2">
	<li>把用不上的设备删除一下！【如果直通的网口不够用，也可以直接用虚拟网口，实际体验都差不多，而这里我选择删除默认的虚拟网口。直通一个 pci物理网口给旁路由使用！】</li>
</ol>
<p>删除没用的配置删除没用的配置</p>
<ol start="3">
	<li>接着配置参数。cpu 拉满，直通网口要勾选预留内存！</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>接着添加 op 的镜像文件，添加硬盘&rarr;现有硬盘。找到之前我们上传的 openwrt 镜像！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>最后再添加一下直通的 pci 网口！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>添加网口添加网口</p>
<p>最后我们再检查一下配置，确认没问题后点击保存即可！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<ol start="4">
	<li>找到刚刚部署好的虚拟机，点击打开电源开机！<br />开机成功后【即代码停止滚动以后】，我们按一下回车键进入 op 的 ssh 控制台！</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<ol start="5">
	<li>修改一下 openwrt 的管理 ip！<br />输入以下代码然后按回车键。注意：vi 后面有一个空格。</li>
</ol>
<p>vi /etc/config/network</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>用键盘方向键移动光标到 option ipaddr&lsquo;192.168.2.1&#39; 这行，输入法切换成英文模式，然后按键盘 i 键进行删减，然后修改 ip 地址！<br />这里我设置的 ip 地址为 10.10.10.251</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>修改好后先按一下右上角 esc 按键！接着按 shift+：【冒号键】，然后下面会出现一个冒号输入 wq，按回车键保存即可！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<ol start="6">
	<li>最后我们在控制台输入 reboot ,重启一下openwrt虚拟机！</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>因为我们是直通网口给 OP 的，所以我们需要先接上那个网口的线，链接到交换机或者 AP！不然无法打开op后台页面！<br />【使用虚拟网口的可以无视！】</p>
<p>OpenWrt 调教篇 [旁路由]：</p>
<ol>
	<li>打开浏览器，输入 OP 的管理口 IP【我们上面设置好的 IP】，从网页端设置参数！</li>
</ol>
<p>输入账户密码进行登录！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<ol start="2">
	<li>登录成功后，我们先设置一下网络接口！ [也就是直通的lan口]</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>LAN口的参数如图。网关填写爱快的 ip 地址！dns我写的是114.114.114.114，223.5.5.5，大家有喜欢的 dns 也可以填写其他的：比如运营商 dns</p>
<p>设置lan口设置lan口</p>
<p>把最下面的 dhcp 服务器设置，忽略此网口打勾！ ipv6 设置里面全部设置成禁用<br />最后点击保存即可！<br /><img alt="请输入图片描述" loading="lazy" src="https://am.zdmimg.com/202107/26/60fed37deca1a9552.png_e1080.jpg" title="请输入图片描述" /><br />ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>3.openwrt 最最最后一步！也是最关键的，设置一下防火墙，设置不正确的话会无法上网！！！<br />找到 网络&rarr;防火墙 ，编辑一下 lan 接口，把 ip 动态伪装 + mss 钳制都打勾一下！<br />LAN 下面有一个 WAN 的，设置作为旁路由的话，要把这个 WAN 的转发给删除掉！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>最后保存一下设置，就可以正常上网了。</p>
<p>如果大家设置后出现了无法上网的情况，请检查防火墙或者 dns！<br />最后我再跟大家讲解一下，如何让规划局域网里面的某些设备，通过 openwrt 旁路由进行上网</p>
<p>我们首先到爱快的 dhcp 列表里面，把需要走op上网的设备 ip 设置成静态的 ip。【注意 ip 范围，我设置的 op dhcp 范围是 151-200】</p>
<p>主路由设置完静态 IP 后，设备重新获取一下网络【拔线或者重启网络】，就可以了！【反之则把 ip 改到正常上网的 ip 范围之外！】</p>
<p>实践大于理论，这里我给大家演示一下吧！</p>
<p>我爱快的 ip 分组，设置的是固定的 IP 范围走 openwrt 旁路由上网。</p>
<p>如图 10.10.10.151-10.10.10.200。<br />IP 尾号 151-200 的设备都会通过 openwrt 的网络进行上网！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>接着我们设置一下需要通过op上网设备的静态 ip。并且把设备的静态 ip 改成 ip 分组的范围之内<br />这里我演示的是 把电脑的IP 固定成 10.10.10.154！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>设置好后，电脑这边重新获取一下网路【禁用网络再启用或者直接插拔网线】<br />然后电脑的 ip 就会变成我们爱快主路由设置的静态 ip。这样就大功告成了</p>
<p>获取的ip 获取的ip&nbsp;</p>
<p>接着我们上网实际测试下！</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>这样就表明，这个设备的网络已经成功通过 op旁路由上网了！</p>
<p>爱快 + OpenWrt 番外篇 [双软路由搞定 IPv6]：<br />ipv6 的优点：当然是给没有 v4 的用户福音了！并且不需要设置转发，局域网下每个设备都是独立的 ip！<br />ipv6 的缺点：可能会影响上网的速度，因为很大一部分网站服务器都是基于 IPv4，可能还没有开通 ipv6，但是我们局域网是 ipv4+ipv6 的，而 ipv6 的 dns 解析优先级更高，导致访问 v4 的网站可能会更慢些。[实际上我用了一两年 v6，没什么感觉]</p>
<p>我这里建议：1. 如果有 ipv4 了，就没必要搞什么 IPv6 访问了。 2. 没有 v4 的用户 [比如艰难的移动宽带用户]，又有外网访问的需求再来折腾 ipv6！</p>
<p>注意：部分地区可能没有开通ipv6相关的线路，能否获取请自测！！！</p>
<p>这里就不再啰嗦了，直接给大家实际操作一下！</p>
<ol>
	<li>爱快主路由这边打开 IPv6！</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>按上面设置好后，就可以成功获取到ipv6了，如果获取不到说明你本地运营商没有部署v6！</p>
<p>爱快ipv6获取成功！爱快ipv6获取成功！</p>
<ol start="2">
	<li>接着我们设置一下 openwrt<br />我们需要添加一个自定义接口，大家按我截图设置！</li>
</ol>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>按图设置接口按图设置接口</p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>设置防火墙设置防火墙</p>
<p>注意：接口设置好后，我们还要再去 dhcp 设置里面，把禁止解析 ipv6 的选项取消掉！<br />ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>至此 ipv6 设置已经完成，接着我们把 爱快 + openwrt 都重启一下，然后再验证一下是否能够正常 ipv6 访问！<br />访问这个网站测试 v6</p>
<p><a href="http://test-ipv6.alpinedc.ch/">http://test-ipv6.alpinedc.ch/</a></p>
<p>ESXi搭建 ALL IN ONE 服务器之双软路由篇</p>
<p>IPV6测试通过！IPV6测试通过！</p>
<p>由于近期爱快有重大更新【DHCP静态分配: 支持配置网关地址】，这样我们配置的时候就可以不用建立多个dhcp ，跳过这一步，直接在静态设备指定旁路由OP的网关！方便快捷！</p>


            <p class="post-info">
                 本文由 
                <a href="/">天下长安长乐未央</a>
                 创作，采用 
                <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">知识共享署名4.0</a>
                 国际许可协议进行许可。
                <br>
                本站文章除注明转载/出处外，均为本站原创或翻译，转载前请务必署名。 
            </p>

  <p class="post-info">
      <br>上一篇：<a href='/article/2.html'>Memos 是一款开源的 flomo 替代工具</a></br>
      <br>下一篇：<a href='/article/38.html'>免费图床</a></br></p>
   </p>


        </div>
    </article>


    <div id="post-bottom-bar" class="post-bottom-bar">
        <div class="bottom-bar-inner">
            <div class="bottom-bar-items social-share left">
                <span class="bottom-bar-item">Share : </span>
                <span class="bottom-bar-item bottom-bar-facebook">
                    <a href="https://www.facebook.com/sharer/sharer.php?u=//article/3.html" target="_blank" title="ESXi搭建 ALL IN ONE 服务器之双软路由篇" rel="nofollow">Facebook</a>
                </span>
                <span class="bottom-bar-item bottom-bar-twitter">
                    <a href="https://twitter.com/intent/tweet?url=//article/3.html&text=ESXi搭建 ALL IN ONE 服务器之双软路由篇" target="_blank" title="ESXi搭建 ALL IN ONE 服务器之双软路由篇" rel="nofollow">Twitter</a>
                </span>
                <span class="bottom-bar-item bottom-bar-weibo">
                    <a href="http://service.weibo.com/share/share.php?url=//article/3.html&amp;title=ESXi搭建 ALL IN ONE 服务器之双软路由篇" target="_blank" title="ESXi搭建 ALL IN ONE 服务器之双软路由篇" rel="nofollow">Weibo</a>
                </span>
                <span class="bottom-bar-item bottom-bar-qrcode">
                    <a href="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=//article/3.html" target="_blank" rel="nofollow">QR code</a>
                </span>
            </div>
            <div class="bottom-bar-items right">
                <span class="bottom-bar-item"></span>
                <span class="bottom-bar-item">
                    <a href="//article/3.html" title="ESXi搭建 ALL IN ONE 服务器之双软路由篇">→</a>
                </span>
                <span class="bottom-bar-item">
                    <a href="#footer">↓</a>
                </span>
                <span class="bottom-bar-item">
                    <a href="#">↑</a>
                </span>
            </div>
        </div>
    </div>
    <div class="related-post-lists">
        <div class="post-lists">
            <div class="post-lists-body">






                <div class="post-list-item">
                    <div class="post-list-item-container">
                        <div class="item-label">
                            <div class="item-title">
                                <a href="/article/35.html">N5105/N6005主机esxi关机变重启问</a>
                            </div>
                            <div class="item-meta clearfix">
                                <div class="item-meta-ico bg-ico-image" style="background: url(/static/pingsu/images/bg-ico.png) no-repeat;background-size: 40px auto;"></div>
                                <div class="item-meta-cat">

   <a href="/list/Web/" title="Web">Web</a>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="post-list-item">
                    <div class="post-list-item-container">
                        <div class="item-label">
                            <div class="item-title">
                                <a href="/article/33.html">ESXi搭建 ALL IN ONE 服务器之双软</a>
                            </div>
                            <div class="item-meta clearfix">
                                <div class="item-meta-ico bg-ico-image" style="background: url(/static/pingsu/images/bg-ico.png) no-repeat;background-size: 40px auto;"></div>
                                <div class="item-meta-cat">

   <a href="/memos/" title="备忘录">备忘录</a>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="post-list-item">
                    <div class="post-list-item-container">
                        <div class="item-label">
                            <div class="item-title">
                                <a href="/article/54.html">potplayer怎么设置无边框</a>
                            </div>
                            <div class="item-meta clearfix">
                                <div class="item-meta-ico bg-ico-image" style="background: url(/static/pingsu/images/bg-ico.png) no-repeat;background-size: 40px auto;"></div>
                                <div class="item-meta-cat">

   <a href="/list/Windows/" title="Windows">Windows</a>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="post-list-item">
                    <div class="post-list-item-container">
                        <div class="item-label">
                            <div class="item-title">
                                <a href="/article/53.html">Win 11系统安装提示:若要获取疑难</a>
                            </div>
                            <div class="item-meta clearfix">
                                <div class="item-meta-ico bg-ico-image" style="background: url(/static/pingsu/images/bg-ico.png) no-repeat;background-size: 40px auto;"></div>
                                <div class="item-meta-cat">

   <a href="/list/Windows/" title="Windows">Windows</a>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="post-list-item">
                    <div class="post-list-item-container">
                        <div class="item-label">
                            <div class="item-title">
                                <a href="/article/50.html">帝国CMS实现独立附件服务器</a>
                            </div>
                            <div class="item-meta clearfix">
                                <div class="item-meta-ico bg-ico-image" style="background: url(/static/pingsu/images/bg-ico.png) no-repeat;background-size: 40px auto;"></div>
                                <div class="item-meta-cat">

   <a href="/list/Web/" title="Web">Web</a>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>



            </div>
        </div>
    </div>

<!-- 暂时关闭
    <div id="respond-post-32" class="comment-container">
        <div id="comments" class="clearfix">
            <span class="response">
                Responses / You are 
                <a href="http://10.0.0.5:9009/admin/profile.php" data-no-instant>天下长安长乐未央</a>
                 here, do you want to 
                <a href="http://10.0.0.5:9009/index.php/action/logout?_=7d531547ee4b0c407a0654bd375e3737" title="Logout" data-no-instant>logout</a>
                 ? 
                <a id="cancel-comment-reply-link" href="http://10.0.0.5:9009/index.php/Web/32.html#respond-post-32" rel="nofollow" style="display:none" onclick="return TypechoComment.cancelReply();"> / Cancel Reply</a>
            </span>
            <form method="post" action="http://10.0.0.5:9009/index.php/Web/32.html/comment" id="comment-form" class="comment-form" role="form" onsubmit="getElementById('misubmit').disabled=true;return true;">
                <textarea name="text" id="textarea" class="form-control" placeholder="Your comment here. Be cool. " required></textarea>
                <button type="submit" class="submit" id="misubmit">SUBMIT</button>
                <input type="hidden" name="_" value="1b7ad8fdaa04237350aa8e0808dde5f8">
            </form>
        </div>
    </div>
-->

<!-- 底部 -->


  <footer id="footer" class="footer bg-white">
        <div class="footer-social">
            <div class="footer-container clearfix">
                <div class="social-list">
链接：
  <a href="https://www.029-china.com.cn" title="旅游年票" target="_blank">旅游年票</a>
  <a href="https://888268.xyz" title="天下长安" target="_blank">天下长安</a>
  <a href="https://www.029-china.com.cn" title="陕西旅游年票" target="_blank">陕西旅游年票</a>
  <a href="https://www.029-china.com.cn" title="西北旅游年票" target="_blank">西北旅游年票</a>
  <a href="https://888268.xyz" title="天下长安长乐未央" target="_blank">天下长安长乐未央</a>
  <a href="https://blog.888268.xyz" title="长乐未央" target="_blank">长乐未央</a>

                </div>
            </div>
        </div>
        <div class="footer-meta">
            <div class="footer-container">
                <div class="meta-item meta-copyright">
                    <div class="meta-copyright-info">
                        <a href="/" class="info-logo">
                            <img src="/static/pingsu/images/crossplane-icon.svg" alt="天下长安长乐未央"/>
                        </a>
                        <div class="info-text">
<script type="text/javascript" src="https://site.qb86.cn/hitokoto/api.php?format=js&charset=utf-8"></script><script>hitokoto()</script>
                            
                            <p>
                                <a href="/" target="blank">萌ICP20000520</a>
                            </p>
                            <p>
                                &copy; 2007-2023 
                                <a href="/">天下长安长乐未央</a>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="meta-item meta-posts">
                    <h3 class="meta-title">HOT POSTS</h3>
<li><a href="/article/3.html" title="ESXi搭建 ALL IN ONE 服务器之双软路由篇">ESXi搭建 ALL IN ONE 服务器之双软</a></li><li><a href="/article/2.html" title="Memos 是一款开源的 flomo 替代工具">Memos 是一款开源的 flomo 替代工</a></li><li><a href="/article/6.html" title="群晖 思源笔记docker 部署 踩坑">群晖 思源笔记docker 部署 踩坑</a></li><li><a href="/article/20.html" title="常见博客程序">常见博客程序</a></li><li><a href="/article/46.html" title="帝国cms7.5模板友情链接SQL调用代码标签的调用方法">帝国cms7.5模板友情链接SQL调用代</a></li><li><a href="/article/45.html" title="帝国常用标签汇总">帝国常用标签汇总</a></li><li><a href="/article/7.html" title="帝国cms中常用标签（总结）">帝国cms中常用标签（总结）</a></li><li><a href="/article/1.html" title="AdGuard 设置">AdGuard 设置</a></li>

                </div>
                <div class="meta-item meta-tags">
                    <h3 class="meta-title">RECENT POSTS</h3>

<li><a href="/article/54.html" title="potplayer怎么设置无边框">potplayer怎么设置无边框</a></li><li><a href="/article/53.html" title="Win 11系统安装提示:若要获取疑难解答提示,请使用其他设备并访问aka.ms/networksetup">Win 11系统安装提示:若要获</a></li><li><a href="/article/50.html" title="帝国CMS实现独立附件服务器">帝国CMS实现独立附件服务器</a></li><li><a href="/article/49.html" title="JS记录并显示网页的最后修改时间">JS记录并显示网页的最后修</a></li><li><a href="/article/48.html" title="帝国cms内容页某个字段没有填写就不显示的解决方法">帝国cms内容页某个字段没有</a></li><li><a href="/article/47.html" title="帝国CMS教程：如果文章没有缩略图，随机调用自定义缩略图">帝国CMS教程：如果文章没有缩</a></li><li><a href="/article/46.html" title="帝国cms7.5模板友情链接SQL调用代码标签的调用方法">帝国cms7.5模板友情链接SQL</a></li><li><a href="/article/45.html" title="帝国常用标签汇总">帝国常用标签汇总</a></li>                </div>
            </div>
    </footer>



    <div id="directory-content" class="directory-content">
        <div id="directory"></div>
    </div>
    <script>
    var postDirectoryBuild = function() {
        var postChildren = function children(childNodes, reg) {
                var result = [],
                    isReg = typeof reg === 'object',
                    isStr = typeof reg === 'string',
                    node,
                    i,
                    len;
                for (i = 0, len = childNodes.length; i < len; i++) {
                    node = childNodes[i];
                    if ((node.nodeType === 1 || node.nodeType === 9) && (!reg || isReg && reg.test(node.tagName.toLowerCase()) || isStr && node.tagName.toLowerCase() === reg)) {
                        result.push(node);
                    }
                }
                return result;
            },
            createPostDirectory = function(article, directory, isDirNum) {
                var contentArr = [],
                    titleId = [],
                    levelArr,
                    root,
                    level,
                    currentList,
                    list,
                    li,
                    link,
                    i,
                    len;
                levelArr = (function(article, contentArr, titleId) {
                    var titleElem = postChildren(article.childNodes, /^hd$/),
                        levelArr = [],
                        lastNum = 1,
                        lastRevNum = 1,
                        count = 0,
                        guid = 1,
                        id = 'directory' + (Math.random() + '').replace(/D/, ''),
                        lastRevNum,
                        num,
                        elem;
                    while (titleElem.length) {
                        elem = titleElem.shift();
                        contentArr.push(elem.innerHTML);
                        num = +elem.tagName.match(/d/)[0];
                        if (num > lastNum) {
                            levelArr.push(1);
                            lastRevNum += 1;
                        } else if (num === lastRevNum || num > lastRevNum && num <= lastNum) {
                            levelArr.push(0);
                            lastRevNum = lastRevNum;
                        } else if (num < lastRevNum) {
                            levelArr.push(num - lastRevNum);
                            lastRevNum = num;
                        }
                        count += levelArr[levelArr.length - 1];
                        lastNum = num;
                        elem.id = elem.id || (id + guid++);
                        titleId.push(elem.id);
                    }
                    if (count !== 0 && levelArr[0] === 1)
                        levelArr[0] = 0;
                    return levelArr;
                })(article, contentArr, titleId);
                currentList = root = document.createElement('ul');
                dirNum = [0];
                for (i = 0, len = levelArr.length; i < len; i++) {
                    level = levelArr[i];
                    if (level === 1) {
                        list = document.createElement('ul');
                        if (!currentList.lastElementChild) {
                            currentList.appendChild(document.createElement('li'));
                        }
                        currentList.lastElementChild.appendChild(list);
                        currentList = list;
                        dirNum.push(0);
                    } else if (level < 0) {
                        level *= 2;
                        while (level++) {
                            if (level % 2)
                                dirNum.pop();
                            currentList = currentList.parentNode;
                        }
                    }
                    dirNum[dirNum.length - 1]++;
                    li = document.createElement('li');
                    link = document.createElement('a');
                    link.href = '#' + titleId[i];
                    link.innerHTML = !isDirNum ? contentArr[i] : dirNum.join('.') + ' ' + contentArr[i];
                    li.appendChild(link);
                    currentList.appendChild(li);
                }
                directory.appendChild(root);
            };
        createPostDirectory(document.getElementById('post-content'), document.getElementById('directory'), true);
    };
    postDirectoryBuild();
    </script>
    <script>
    (function() {
        window.TypechoComment = {
            dom: function(id) {
                return document.getElementById(id);
            },
            create: function(tag, attr) {
                var el = document.createElement(tag);
                for (var key in attr) {
                    el.setAttribute(key, attr[key]);
                }
                return el;
            },
            reply: function(cid, coid) {
                var comment = this.dom(cid),
                    parent = comment.parentNode,
                    response = this.dom('respond-post-32'),
                    input = this.dom('comment-parent'),
                    form = 'form' == response.tagName ? response : response.getElementsByTagName('form')[0],
                    textarea = response.getElementsByTagName('textarea')[0];
                if (null == input) {
                    input = this.create('input', {
                        'type': 'hidden',
                        'name': 'parent',
                        'id': 'comment-parent'
                    });
                    form.appendChild(input);
                }
                input.setAttribute('value', coid);
                if (null == this.dom('comment-form-place-holder')) {
                    var holder = this.create('div', {
                        'id': 'comment-form-place-holder'
                    });
                    response.parentNode.insertBefore(holder, response);
                }
                comment.appendChild(response);
                this.dom('cancel-comment-reply-link').style.display = '';
                if (null != textarea && 'text' == textarea.name) {
                    textarea.focus();
                }
                return false;
            },
            cancelReply: function() {
                var response = this.dom('respond-post-32'),
                    holder = this.dom('comment-form-place-holder'),
                    input = this.dom('comment-parent');
                if (null != input) {
                    input.parentNode.removeChild(input);
                }
                if (null == holder) {
                    return true;
                }
                this.dom('cancel-comment-reply-link').style.display = 'none';
                holder.parentNode.insertBefore(response, holder);
                return false;
            }
        };
    })();
    </script>
    <script src="//cdn.bootcss.com/headroom/0.9.1/headroom.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.10.0/highlight.min.js"></script>
    <script>
    var postDirectory = new Headroom(document.getElementById("directory-content"), {
        tolerance: 0,
        offset: 280,
        classes: {
            initial: "initial",
            pinned: "pinned",
            unpinned: "unpinned"
        }
    });
    postDirectory.init();
    var postSharer = new Headroom(document.getElementById("post-bottom-bar"), {
        tolerance: 0,
        offset: 70,
        classes: {
            initial: "animated",
            pinned: "pinned",
            unpinned: "unpinned"
        }
    });
    postSharer.init();
    var header = new Headroom(document.getElementById("header"), {
        tolerance: 0,
        offset: 70,
        classes: {
            initial: "animated",
            pinned: "slideDown",
            unpinned: "slideUp"
        }
    });
    header.init();
    hljs.initHighlightingOnLoad();
    </script>

<link href="/skin/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/skin/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</body>
</html>
